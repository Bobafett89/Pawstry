<!DOCTYPE html>
<html>
    <head>
        <title>Super duper game</title>
        <style>
            .Cell {
                background-color: green;
                height: 60px; 
                width: 60px;
                border: solid 2px;
            }
            .Cell[tower="Basic"] {
                background-color: blue;
            }
            .Cell:hover {
                background-color: red;
            }
        </style>    
        <script>
            class GameManager {
                cellSize = 60;
                cells = [];
                enemies = [];
                waves = 0;

                constructor (cells, lanes) {
                    for(let i = 0; i < lanes; i++) {
                        this.cells.push([]);
                    }
                    this.cells.forEach((lane) => {lane.length = cells});
                }

                start() {
                    this.createField();
                    this.spawnEnemies(2);
                    this.spawnEnemies(1);
                }

                update(fps) {
                    this.enemies.forEach((enemy) => {enemy.move(fps)});
                    setTimeout(this.update.bind(this), 1000/fps, fps);
                }

                createField() {
                    for(let lane = 0; lane < this.cells.length; lane++) {
                        document.write("<div style='display: flex;'>");
                        for(let cell = 0; cell < this.cells[lane].length; cell++) {
                            let id = `c_${lane}_${cell}`;
                            document.write(`<div id="${id}" class="Cell" tower="Empty"></div>`);
                            document.getElementById(id).addEventListener("click", (event) => this.createTower(event.target.id));
                        }
                        document.write("</div>");
                    }
                }

                createTower(cell) {
                    let idParts = cell.split("_");
                    this.cells[idParts[1]][idParts[2]] = new Tower;
                    document.getElementById(cell).setAttribute("tower", "Basic");
                }

                spawnEnemies(amount) {
                    let speed = 60;
                    let x = 64 * this.cells[0].length + 8;

                    for(let i = 0; i < amount; i++) {
                        let lane = Math.floor(Math.random() * this.cells.length);
                        let y = 64 * lane + 8 + 10;

                        this.enemies.push(new Enemy(speed, lane, x, y, `e_${this.waves}_${i}`));
                        this.enemies[this.enemies.length-1].createSprite();
                    }
                    this.waves++;
                }
            }

            class Enemy {
                speed;
                x;
                y;
                lane;
                id;
                disabled = false;

                constructor(speed, lane, x, y, id) {
                    this.speed = speed;
                    this.lane = lane;
                    this.x = x;
                    this.y = y;
                    this.id =  id;
                }

                createSprite() {
                   document.write(`<div id="${this.id}" style='position: absolute; width: 40px; height: 40px; background-color: yellow; left: ${this.x}px; top: ${this.y}px;'></div>`);
                }

                move(fps) {
                    if(!this.disabled) {
                        let sprite = document.getElementById(this.id.toString());
                        this.x = Number(sprite.style.left.replace("px", "")) - this.speed / fps;
                        sprite.style.left = this.x.toString() + "px";
                        if(this.x <= 0) {
                            this.disabled = true;
                            sprite.hidden = true;
                        }
                    }
                }
            }

            class Tower {
            }
        </script>
    </head>
    <body>
        <script>
            let game = new GameManager(7, 5);
            game.start();
            game.update(60);
        </script>
    </body>
</html>